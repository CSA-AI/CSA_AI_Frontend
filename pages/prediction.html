---
layout: project
---

<head>
  <!-- ApexCharts CDN -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <style>
    /* Ensure the chart container has a fixed height */
    #chart {
      height: 400px; /* Adjust height as needed */
    }
  </style>
</head>

<div class="hero"></div>

<label for="ticker">Select a stock:</label>
<select id="ticker">
    <option value="GOOGL">GOOGL</option>
    <option value="AMZN">AMZN</option>
    <option value="AAPL">AAPL</option>
    <option value="TSLA">TSLA</option>
    <option value="WMT">WMT</option>
    <option value="MSFT">MSFT</option>
    <option value="META">META</option>
    <option value="COST">COST</option>
    <option value="LMT">LMT</option>
    <option value="NOC">NOC</option>
    <option value="UNH">UNH</option>
</select>
<button onclick="getStockData()" class="btn">Get Monthly Data</button>

<div class="card w-1/2 shadow-xl">
  <div class="card-body">
    <div id="chart"></div>
  </div>
</div>

<script>
    const rapidApiKey = 'a96f7bb54emshee5a698b2344228p12bd6cjsnbb7e0177bdb6'; // Replace 'your_rapid_api_key' with your actual RapidAPI Key
    const rapidApiHost = 'alpha-vantage.p.rapidapi.com';
  
    async function getStockData() {
      const symbol = document.getElementById("ticker").value;
      const url = `https://${rapidApiHost}/query?function=TIME_SERIES_MONTHLY&symbol=${symbol}&datatype=json&output_size=compact`;
  
      const options = {
        method: 'GET',
        headers: {
          'X-RapidAPI-Key': rapidApiKey,
          'X-RapidAPI-Host': rapidApiHost
        }
      };
  
      try {
        // Fetch Alpha Vantage data
        const response = await fetch(url, options);
        const alphaData = await response.json();
  
        let alphaTimes = []; // Will store the dates from Alpha Vantage
        let alphaCloses = []; // Will store the closing prices from Alpha Vantage
  
        // The API response structure for monthly data is different, adjust accordingly
        for (let time in alphaData['Monthly Time Series']) {
          alphaTimes.push(new Date(time).getTime()); // Convert date to timestamp
          alphaCloses.push(parseFloat(alphaData['Monthly Time Series'][time]['4. close'])); // Use closing price
        }
  
        // Reverse the arrays to display data in descending order (from latest to earliest)
        alphaTimes.reverse();
        alphaCloses.reverse();

        // Fetch LSTM prediction data
        const lstmResponse = await fetch(`http://localhost:8017/api/lstm/${symbol}`);
        const lstmData = await lstmResponse.json();

        let lstmTimes = []; // Will store the dates from LSTM
        let lstmCloses = []; // Will store the predicted values from LSTM
  
        // Extract predicted values from LSTM data
        lstmData.forEach(entry => {
            const [index, dateString, prediction] = entry.split(',');
            const date = new Date(dateString); // Convert date string to JavaScript Date object
            lstmTimes.push(date.getTime()); // Convert date to timestamp
            lstmCloses.push(parseFloat(prediction)); // Use predicted value
        });

        // Draw ApexCharts
        var apexOptions = {
          series: [{
            name: 'Alpha Vantage',
            data: alphaCloses
          }, {
            name: 'LSTM Prediction',
            data: lstmCloses
          }],
          chart: {
            type: 'area',
            height: 350,
            zoom: {
              enabled: true
            }
          },
          dataLabels: {
            enabled: false
          },
          stroke: {
            curve: 'smooth' // Adjust line width for better visibility
          },
          markers: {
            size: 4 // Increase marker size for better visibility
          },
          xaxis: {
            type: 'datetime',
            categories: alphaTimes.map(time => new Date(time).toISOString()) // Convert timestamps to ISO string format
          },
          tooltip: {
            x: {
              format: 'dd/MM/yy HH:mm'
            },
          },
        };
  
        var apexChart = new ApexCharts(document.querySelector("#chart"), apexOptions);
        apexChart.render();
  
      } catch (error) {
        console.error(error);
      }
    }
</script>